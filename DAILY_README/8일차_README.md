# 8ì¼ì°¨

# ë¥˜ì›ì°½

# ëœë¤ ì˜í™” ì¶”ì²œ í˜ì´ì§€

- ëœë¤ ì˜í™” ì¶”ì²œ í˜ì´ì§€ëŠ” ì²˜ìŒ ìƒê°ì€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•„ë˜ì— ì˜í™” ì¹´ë“œê°€ ë‚˜ì˜¤ëŠ” ë°©ì‹ì„ ìƒê°í–ˆëŠ”ë°,
- ì´ ê³¼ì •ì´ ìƒê°ë³´ë‹¤ ì‰½ì§€ì•Šë‹¤.
- í˜„ì¬ ì˜í™” ì¹´ë“œì— ìŠ¤íƒ€ì¼ì´ ì”ëœ© ë“¤ì–´ê°€ ìˆëŠ”ë° ë‚´ê°€ ì›í•˜ëŠ” ì‚¬ì´ì¦ˆë¡œ ë³€ê²½í•˜ëŠ”ê²Œ ì‰½ì§€ê°€ ì•Šë‹¤.
- ê·¸ë˜ì„œ ìƒê°í•œ ê²°ë¡ ì€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëœë¤ìœ¼ë¡œ ì˜í™” ë””í…Œì¼ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤.

![Untitled](8ì¼ì°¨_ë¥˜ì›ì°½/Untitled.png)

# í˜ì´ì§€ ë‹¤ë“¬ê¸°

- í˜„ì¬ í˜ì´ì§€ì˜ ë””í…Œì¼ì ì¸ ë¶€ë¶„ì´ ë‹¤ë“¬ì–´ ì§€ì§€ ì•Šì•˜ë‹¤.
- ì‹œê°„ì´ ì—†ê¸° ë•Œë¬¸ì— ê³„íší•œ í˜ì´ì§€ë“¤ì„ ë§Œë“¤ì§€ ëª»í• ê²ƒê°™ë‹¤.
- ë˜í•œ ë„¤ë¸Œë°”ì˜ ëŠ¦ì€ ë„ì…ìœ¼ë¡œ ë„¤ë¸Œë°”ì˜ styleì„ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ë•Œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ë„ ì˜í–¥ì„ ì£¼ê¸° ë•Œë¬¸ì—
- í˜„ì¬ ë§Œë“¤ì–´ì§„ í˜ì´ì§€ë“¤ì„ ì „ì²´ì ìœ¼ë¡œ ë‹¤ë“¬ì–´ì•¼ê² ë‹¤.

# ì¥ë¥´ë³„ ì˜í™” í˜ì´ì§€ ë§Œë“¤ê¸° ë° ë¬´í•œìŠ¤í¬ë¡¤

- ì¥ë¥´ë³„ë¡œ ì˜í™”ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€ë¥¼ ë§Œë“¤ì—ˆê³ , ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í–ˆë‹¤.
- ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ëŠ” ì‰¬ìš´ ë°©ì‹ ì¤‘ í•˜ë‚˜ëŠ” interì–´ì©Œêµ¬ apië¥¼ ì“°ëŠ” ê²ƒì´ì—ˆëŠ”ë°, ë¬¸ì„œ ë³´ê¸°ê°€ ì‹œê°„ì´ ì—†ì–´ì„œ
- ê·¸ëƒ¥ í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì™€ ì „ì²´ ë†’ì´ë¡œ ëŒ€ì¶© ê³„ì‚°í•´ì„œ dataì— ì˜í™”ì •ë³´ë¥¼ ê°€ì§€ê³ ìˆëŠ” ë°°ì—´ì— ë„£ì–´ì¤€ë‹¤.

### ë¬¸ì œëŠ” this

- mountedì•ˆì—ì„œ thisëŠ” vueë¥¼ ê°€ë¥´í‚¤ì§€ë§Œ, mountedì•ˆì˜ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆì•ˆì€ thisê°€ ìœˆë„ìš°ë¥¼ ê°€ë¥´ì¼œì„œ ê³„ì† ì˜¤ë¥˜ê°€ ë–³ë‹¤.
- ê·¸ë˜ì„œ, ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆë¥¼ ìµëª…í•¨ìˆ˜ë¡œ ì‚¬ìš©í•˜ì˜€ë”ë‹ˆ thisê°€ ì œëŒ€ë¡œ vueë¥¼ ê°€ë¥´í‚¤ê³ , í•¨ìˆ˜ ë˜í•œ ì œëŒ€ë¡œ ì‹¤í–‰ ë˜ì—ˆë‹¤.

![Untitled](8ì¼ì°¨_ë¥˜ì›ì°½/Untitled%201.png)

![Untitled](8ì¼ì°¨_ë¥˜ì›ì°½/Untitled%202.png)

- ìŠ¤í¬ë¡¤ì´ ë°‘ì— ìª½ì— ìˆìœ¼ë©´ ê³„ì† ì˜í™”ì˜ ì •ë³´ë¥¼ dataì— ë„£ì–´ì¤€ë‹¤.

# ì˜í™” ì¡°íšŒ í˜ì´ì§€ ì§„í–‰ì¤‘

- ì˜í™”ë¥¼ ì¥ë¥´ë³„ ë˜ëŠ” ì „ì²´ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ì•¼í•˜ëŠ”ë°, ë””ìì¸ì€ ê°•ì˜ì‹¤ì—ì„œ ì¢€ í•´ë†¨ë‹¤.
- ì ì ˆí•œ ì •ë³´ë§Œ ì¶”ê°€í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

![Untitled]8ì¼ì°¨_ë¥˜ì›ì°½/Untitled%203.png)

- ì™¼ìª½ì˜ ë„¤ë¹„ê²Œì´ì…˜ì€ ê¸‰í•˜ê²Œ ìƒê°ë‚˜ì„œ ë§Œë“ ê±°ë¼ ì´ë¯¸ ì „ì²´ ì¹´ë“œì˜ ë°°ì¹˜ì˜ í‹€ì„ ì¡ì•„ë²„ë ¸ëŠ”ë°,
- ì¶”ê°€ì ìœ¼ë¡œ ë„¤ë¹„ê²Œì´ì…˜ì„ ì¶”ê°€í•˜ê¸°ì—ëŠ” ì‹œê°„ì´ ì˜¤ë˜ê±¸ë¦°ë‹¤.
- í¬ì§€ì…˜ì„  absoluteë¡œ ì¡ì•„ë²„ë ¤ì„œ ì¡°ì •í•˜ëŠ” ìˆ˜ ë°–ì— ì—†ë‹¤. ì§€ê¸ˆì€..

# ì •ë¦¬ ì™„ë£Œ

![Untitled](8ì¼ì°¨_ë¥˜ì›ì°½/Untitled%204.png)

# ë‹¤ë“¬ê¸° ê±°ì˜ ì™„ë£Œ ì˜¤ëŠ˜ ë§ˆë¬´ë¦¬

![Untitled](8ì¼ì°¨_ë¥˜ì›ì°½/Untitled%205.png)

&nbsp;
---
&nbsp;


# ì´ì§€ì€

- [x]  í”„ë¡œí•„ í˜ì´ì§€ ì ‘ê·¼
- [x]  í”„ë¡œí•„ í˜ì´ì§€ì— ì°œ ëª©ë¡ / ë°©ëª…ë¡ ê¸°ëŠ¥ ë§Œë“¤ê¸°
- [x]  ì†Œê° ğŸ“•

# í”„ë¡œí•„ í˜ì´ì§€

### ë°©ëª…ë¡ ê¸°ëŠ¥

comments**/models.py**

```python
class Profile(models.Model):
    usernumber = models.IntegerField()

class Comment(models.Model):
    profile = models.ForeignKey(Profile, on_delete=models.CASCADE)
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.content
```

`Profile, Comment ëª¨ë¸ ì •ì˜`

- ë¡œê·¸ì¸ í›„ Intropage ì— ë“¤ì–´ì˜¤ë©´ **Profile usernumber DB** ê°€ ì €ì¥ë˜ëŠ” í•¨ìˆ˜ ì‘ì„±í•˜ê¸°
- usernumberì´ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ ì‚¬ìš©ìê°€ usernumberì„ idë¡œ ê°–ëŠ” user í”„ë¡œí•„ì— ì ‘ê·¼í•´ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤.
- ê·¸ë™ì•ˆ ê³„ì†í•´ì„œ ë°°ì› ë˜ article_id ì— ì ‘ê·¼í•´ comment ë¥¼ ë‚¨ê¸°ëŠ” article-comment ê´€ê³„ë¥¼
- usernumber-comment ê´€ê³„ë¡œ ì¬ì •ì˜
- usernumberëŠ” í•˜ë‚˜ì˜ ê²Œì‹œê¸€ ë²ˆí˜¸ì™€ ê°™ì€ ê²ƒì´ë‹¤
    
    â†- ìœ ì €_id ë¼ë¦¬ ì°¸ì¡°í•˜ëŠ” ë°©ë²•ì„ ëª°ë¼ì„œ ì¼ë‹¨ ì´ë ‡ê²Œ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤ â€”>
    

### ì‘ì—… ìˆœì„œ

### 1.  íšŒì›ê°€ì… í•œ user_id / serverì˜ [comments.app](http://comments.app) â†’ Profile Modelsì— ì €ì¥

- íšŒì›ê°€ì…ì„ í•œ ì‚¬ìš©ìëŠ” ìë™ ë¡œê·¸ì¸ í›„ TasteMovie.vue ë¡œ ì´ë™í•˜ê²Œ ëœë‹¤.
- TasteMovie ì—ì„œ ê°€ì…í•œ ìœ ì €ì˜ id ë¥¼ dbì— ì €ì¥

1. `Vue` SignUp ****<  â†’ methods â†’ mapAction() > â†’
2.    **accountsStore**  â†’ <actios(axios)> â†’ 
3. `Django` â†’ url â†’ DB â†’
4. `Vue` â†’  **accountsStore** â†’ getters â†’ state

TastMovie.vue

```jsx
computed: {
    ...mapGetters(accountsStore, ["user", 'authHead']),
  },

  methods: {
    ...mapActions(commentsStore, ['createProfileUser'])
  },

  created() {
    console.log(this.user)
    this.createProfileUser({ usernumber: this.user.id,  authHead: this.authHead})
  },

```

```jsx
accountsStore

// í”„ë¡œí•„ í˜ì´ì§€ ìœ ì € ì •ë³´ ê°–ê³ ì˜¤ê¸°
      getProfileUser( {commit, getters }, profileUserId ) {
        axios({
          method: "get",
          url: `${API_URL}/accounts/profile/${profileUserId.user}`,
          headers: getters.authHead,
        })
        .then((res) => {
          console.log('@@@@@@',res.data);
          commit('GET_PROFILE_USER', res.data.id)
        })
        .catch((err) => {
          console.log(err);
        });
      },
```

**comments-profile-DB**

| id | usernumber |
| --- | --- |
| 1 | 1 |
| 2 | 2 |
| 3 | 3 |
| 4 | 4 |
| 5 | 5 |
| â€¦ | â€¦ |

## ğŸ“•`DBì— ì´ëŸ° ì‹ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ì´ìœ `

í˜„ì¬ ë¡œê·¸ì¸ ì¤‘ì¸ ì‚¬ìš©ì A (  user_pk = 1) ê°€ ì‚¬ìš©ì B( user_id = 10 ) ì˜ í”„ë¡œí•„ í˜ì´ì§€ì— ì ‘ê·¼í•˜ì—¬ ëŒ“ê¸€ì„ ì‘ì„±í•œë‹¤ë©´ ì´ 2ê°œì˜ user data ê°€ í•„ìš”í•˜ë‹¤.

í•˜ë‚˜ì˜ ëª¨ë¸ì— ë‘ê°œì˜ ìœ ì € ë°ì´í„°ë¥¼ ì“°ëŠ” ë°©ë²•ì„ ìƒê°í•˜ì§€ ëª»í–ˆë‹¤. 

ëª¨ë¸ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ì •ì˜ í•  ì§€ ëª°ë¼ì„œ ì¼ë‹¨ì€ íšŒì›ê°€ì… í•œ userì˜ id ë¥¼ usernameì— ëª¨ë‘ ì €ì¥í•´ ë‘ì—ˆë‹¤.

Aê°€ Bì˜ í”„ë¡œí•„ í˜ì´ì§€ì— ë“¤ì–´ê°€ ëŒ“ê¸€ì„ ë‹¨ë‹¤ë©´ Comment.Modelì˜ profile = 10 , user_id=1 ì´ ëœë‹¤.  ì´ë ‡ê²Œ ë˜ë©´ Article-Comment ëª¨ë¸ ì²˜ëŸ¼ ì‰½ê²Œ CRUDê°€ ê°€ëŠ¥í•´ì§„ë‹¤.

í”„ë¡œì íŠ¸ ê¸°ê°„ì´ ì´‰ë°•í•˜ì—¬ ë‘ ìœ ì €ê°€ ì§ì ‘ ì—°ê²°ë  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ìƒê°í•˜ì§€ëŠ” ëª»í–ˆì§€ë§Œ, í”Œì ì´ ëë‚˜ê³  í•´ê²°ì±…ì„ ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë³´ê³ ì‹¶ë‹¤.  

 

### 2. Serverer < - > Clint  â‡’  CRUD

**Django comments/urls**

```python
urlpatterns = [
    # í”„ë¡œí•„ ìœ ì € ìƒì„±
    path('profileuser/', views.profileuser_list, name='profileuser_list'),
  
    # í”„ë¡œí•„ ìœ ì € ì „ì²´ ëŒ“ê¸€ ì¡°íšŒ(GET)
    path('profileuser/<int:profile_pk>/comments/', views.comment_list, name='comment_list'),
    # í”„ë¡œí•„ ìœ ì € ëŒ“ê¸€ ìƒì„±(POST)
    path('profileuser/<int:profile_pk>/comment/', views.comment_create, name='comment_create'),
    # í”„ë¡œí•„ ìœ ì € ëŒ“ê¸€ ì‚­ì œ (DELETE)
    path('profileuser/<int:profile_pk>/comment/<int:comment_pk>/', views.comment_delete, name = 'comment_delete'),
]
```

**Django comments/views**

```python
from rest_framework.response import Response
from rest_framework.decorators import api_view
from rest_framework.decorators import permission_classes
from rest_framework.permissions import IsAuthenticatedOrReadOnly
from rest_framework import status

from django.shortcuts import get_list_or_404, get_object_or_404
from comments.serializers import ProfileSerializer, CommentSerializer, ProfileListSerializer
from comments.models import Comment, Profile
from django.contrib.auth import get_user_model

# íšŒì›ê°€ì… í•œ ìœ ì €id ì¡°íšŒ(GET), ìƒì„±(POST)
@api_view(['GET', 'POST'])
@permission_classes([IsAuthenticatedOrReadOnly])
def profileuser_list(request):
    print(request)
    if request.method == 'GET':
        profiles = get_list_or_404(Profile.objects.order_by('-pk'))
        serializer = ProfileListSerializer(profiles, many=True)
        return Response(serializer.data)

    elif request.method == 'POST':
        serializer = ProfileSerializer(data=request.data)
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            # serializer.save(user=request.user)
            return Response(serializer.data, status=status.HTTP_201_CREATED)

# ìœ ì € í”„ë¡œí•„ í˜ì´ì§€ ëŒ“ê¸€ ì¡°íšŒ(GET), ìƒì„±(POST), ì‚­ì œ(DELETE)

@api_view(['GET'])
def comment_list(request, profile_pk):
# í”„ë¡œí•„ ìœ ì € ì „ì²´ ëŒ“ê¸€ ì¡°íšŒ(GET)
    profile = get_object_or_404(Profile, pk=profile_pk)
    comments = profile.comment_set.all()
    # ì—­ì°¸ì¡° profile : comment 1:N
    serializers = CommentSerializer(comments, many=True)
    return Response(serializers.data)

@api_view(['POST'])
@permission_classes([IsAuthenticatedOrReadOnly])
def comment_create(request, profile_pk):
# í”„ë¡œí•„ ìœ ì € ëŒ“ê¸€ ìƒì„±(POST)
    profile = get_object_or_404(Profile, pk=profile_pk)
    serializer = CommentSerializer(data=request.data)
    if serializer.is_valid(raise_exception=True):
        serializer.save(user=request.user, profile = profile)

        return Response(serializer.data, status=status.HTTP_201_CREATED)

@api_view(['DELETE'])
@permission_classes([IsAuthenticatedOrReadOnly])
def comment_delete(request, profile_pk, comment_pk):

    comment = get_object_or_404(Comment, pk=comment_pk)
    # ìƒì„¸ ëŒ“ê¸€ .filter(pk=comment_pk)
    if request.user == comment.user:
    # ëŒ“ê¸€ ì‘ì„±ìì™€ ê°™ì€ ê²½ìš° 
        comment.delete()
        data = {
            'delete': f'ëŒ“ê¸€ {comment_pk}ë²ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'
        }
        return Response(data, status=status.HTTP_204_NO_CONTENT)
    return Response(status=status.HTTP_403_FORBIDDEN)
```

**VUE commentsStore**

```jsx
import axios from "axios";

const API_URL = "http://127.0.0.1:8000";

const commentssStore = {
  namespaced: true,
  state: {
    comments: null,
  },

  getters: {
    comments: (state) => state.comments,
  },

  mutations: {
    CREATE_COMMENT: (state, comment) => (state.comments.unshift(comment)),
    GET_COMMENTS: (state, comments) => (state.comments = comments),
  },

  actions:{
  createProfileUser( { commit }, profileUser ) {
    axios({  
      method: "post",
      url: `${API_URL}/comments/profileuser/`,
      data: {...profileUser},
      headers: profileUser.authHead
    })
    .then((res) => {
      commit
      console.log( 'í”„ë¡œí•„ ìœ ì € ìƒì„± ì™„ë£Œ', res.data)
    })
    .catch((err) => {
      console.log(err)
    })
  },

  // ëŒ“ê¸€ ìƒì„± 
  createComment( { commit }, commentItem) {
    axios({
      method: "post",
      url: `${API_URL}/comments/profileuser/${commentItem.profile}/comment/`,
      data: {content: commentItem.content},
      headers: commentItem.authHead,
    })
    .then((res) => {
      alert('ëŒ“ê¸€ ì‘ì„± ì™„ë£Œ!.')
      commit('CREATE_COMMENT', res.data)
      commit
    })
    .catch((err) => {
      console.log(err)
    })
  },

  // ëŒ“ê¸€ ì¡°íšŒ(GET)
  getComments( { commit }, profileItem) {
    axios({
      method: "get",
      url: `${API_URL}/comments/profileuser/${profileItem.id}/comments/`,
      headers: profileItem.token,
    })
    .then((res) => {
      commit("GET_COMMENTS", res.data);
    })
    .catch((err) => {
      console.log(err)
    })
  },
```